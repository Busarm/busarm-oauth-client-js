!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).BusarmOAuth={})}(this,function(f){"use strict";function I(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}var e={exports:{}},N=I,t=Object.prototype.toString;function s(e){return Array.isArray(e)}function r(e){return void 0===e}function z(e){return"[object ArrayBuffer]"===t.call(e)}function B(e){return null!==e&&"object"==typeof e}function a(e){if("[object Object]"!==t.call(e))return!1;e=Object.getPrototypeOf(e);return null===e||e===Object.prototype}function D(e){return"[object Function]"===t.call(e)}function i(e,t){if(null!=e)if(s(e="object"!=typeof e?[e]:e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var n={isArray:s,isArrayBuffer:z,isBuffer:function(e){return null!==e&&!r(e)&&null!==e.constructor&&!r(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===t.call(e)},isArrayBufferView:function(e){return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&z(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:B,isPlainObject:a,isUndefined:r,isDate:function(e){return"[object Date]"===t.call(e)},isFile:function(e){return"[object File]"===t.call(e)},isBlob:function(e){return"[object Blob]"===t.call(e)},isFunction:D,isStream:function(e){return B(e)&&D(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===t.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:i,merge:function r(){var n={};function e(e,t){a(n[t])&&a(e)?n[t]=r(n[t],e):a(e)?n[t]=r({},e):s(e)?n[t]=e.slice():n[t]=e}for(var t=0,o=arguments.length;t<o;t++)i(arguments[t],e);return n},extend:function(r,e,n){return i(e,function(e,t){r[t]=n&&"function"==typeof e?N(e,n):e}),r},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e=65279===e.charCodeAt(0)?e.slice(1):e}},o=n;function L(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function J(e,t,r){return t&&(r=r?r(t):o.isURLSearchParams(t)?t.toString():(n=[],o.forEach(t,function(e,t){null!=e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),n.push(L(t)+"="+L(e))}))}),n.join("&")))&&(-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r),e;var n}var M=n;function c(){this.handlers=[]}c.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},c.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},c.prototype.forEach=function(t){M.forEach(this.handlers,function(e){null!==e&&t(e)})};function G(e,t,r,n,o){return e.config=t,r&&(e.code=r),e.request=n,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}function W(e,t,r,n,o){return e=new Error(e),X(e,t,r,n,o)}var u,F,l,H=c,V=n,h={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},X=G,$=W,d=n,p=d.isStandardBrowserEnv()?{write:function(e,t,r,n,o,s){var a=[];a.push(e+"="+encodeURIComponent(t)),d.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),d.isString(n)&&a.push("path="+n),d.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Q=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Y=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},y=n,Z=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],ee=n,g=ee.isStandardBrowserEnv()?(F=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a"),u=te(window.location.href),function(e){e=ee.isString(e)?te(e):e;return e.protocol===u.protocol&&e.host===u.host}):function(){return!0};function te(e){return F&&(l.setAttribute("href",e),e=l.href),l.setAttribute("href",e),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:"/"===l.pathname.charAt(0)?l.pathname:"/"+l.pathname}}function m(e){this.message=e}m.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},m.prototype.__CANCEL__=!0;function re(f){return new Promise(function(t,r){var e,n=f.data,o=f.headers,s=f.responseType;function a(){f.cancelToken&&f.cancelToken.unsubscribe(e),f.signal&&f.signal.removeEventListener("abort",e)}v.isFormData(n)&&delete o["Content-Type"];var i,c=new XMLHttpRequest,u=(f.auth&&(u=f.auth.username||"",i=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"",o.Authorization="Basic "+btoa(u+":"+i)),ae(f.baseURL,f.url));function l(){var e;c&&(e="getAllResponseHeaders"in c?ie(c.getAllResponseHeaders()):null,e={data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:e,config:f,request:c},ne(function(e){t(e),a()},function(e){r(e),a()},e),c=null)}c.open(f.method.toUpperCase(),se(u,f.params,f.paramsSerializer),!0),c.timeout=f.timeout,"onloadend"in c?c.onloadend=l:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(l)},c.onabort=function(){c&&(r(w("Request aborted",f,"ECONNABORTED",c)),c=null)},c.onerror=function(){r(w("Network Error",f,null,c)),c=null},c.ontimeout=function(){var e=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",t=f.transitional||ue;f.timeoutErrorMessage&&(e=f.timeoutErrorMessage),r(w(e,f,t.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",c)),c=null},v.isStandardBrowserEnv()&&(i=(f.withCredentials||ce(u))&&f.xsrfCookieName?oe.read(f.xsrfCookieName):void 0)&&(o[f.xsrfHeaderName]=i),"setRequestHeader"in c&&v.forEach(o,function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)}),v.isUndefined(f.withCredentials)||(c.withCredentials=!!f.withCredentials),s&&"json"!==s&&(c.responseType=f.responseType),"function"==typeof f.onDownloadProgress&&c.addEventListener("progress",f.onDownloadProgress),"function"==typeof f.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(e=function(e){c&&(r(!e||e.type?new le("canceled"):e),c.abort(),c=null)},f.cancelToken&&f.cancelToken.subscribe(e),f.signal&&(f.signal.aborted?e():f.signal.addEventListener("abort",e))),n=n||null,c.send(n)})}var b=m,v=n,ne=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t($("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)},oe=p,se=J,ae=function(e,t){return e&&!Q(t)?Y(e,t):t},ie=function(e){var t,r,n={};return e&&y.forEach(e.split("\n"),function(e){r=e.indexOf(":"),t=y.trim(e.substr(0,r)).toLowerCase(),r=y.trim(e.substr(r+1)),!t||n[t]&&0<=Z.indexOf(t)||(n[t]="set-cookie"===t?(n[t]||[]).concat([r]):n[t]?n[t]+", "+r:r)}),n},ce=g,w=W,ue=h,le=b,k=n,fe=function(r,n){V.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])})},he=G,de={"Content-Type":"application/x-www-form-urlencoded"};function pe(e,t){!k.isUndefined(e)&&k.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function ye(e){return!(!e||!e.__CANCEL__)}var A={transitional:h,adapter:_="undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?re:_,transformRequest:[function(e,t){if(fe(t,"Accept"),fe(t,"Content-Type"),k.isFormData(e)||k.isArrayBuffer(e)||k.isBuffer(e)||k.isStream(e)||k.isFile(e)||k.isBlob(e))return e;if(k.isArrayBufferView(e))return e.buffer;if(k.isURLSearchParams(e))return pe(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();if(k.isObject(e)||t&&"application/json"===t["Content-Type"]){pe(t,"application/json");var t=e,r=void 0,n=void 0;if(k.isString(t))try{return(r||JSON.parse)(t),k.trim(t)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(t)}return e}],transformResponse:[function(e){var t=this.transitional||A.transitional,r=t&&t.silentJSONParsing,t=t&&t.forcedJSONParsing,r=!r&&"json"===this.responseType;if(r||t&&k.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw he(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}},p=(k.forEach(["delete","get","head"],function(e){A.headers[e]={}}),k.forEach(["post","put","patch"],function(e){A.headers[e]=k.merge(de)}),A),ge=n,me=p,be=n,ve=function(t,r,e){var n=this||me;return ge.forEach(e,function(e){t=e.call(n,t,r)}),t},we=ye,ke=p,Ae=b;function Se(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ae("canceled")}function Oe(t,r){r=r||{};var n={};function o(e,t){return S.isPlainObject(e)&&S.isPlainObject(t)?S.merge(e,t):S.isPlainObject(t)?S.merge({},t):S.isArray(t)?t.slice():t}function s(e){return S.isUndefined(r[e])?S.isUndefined(t[e])?void 0:o(void 0,t[e]):o(t[e],r[e])}function e(e){if(!S.isUndefined(r[e]))return o(void 0,r[e])}function a(e){return S.isUndefined(r[e])?S.isUndefined(t[e])?void 0:o(void 0,t[e]):o(void 0,r[e])}function i(e){return e in r?o(t[e],r[e]):e in t?o(void 0,t[e]):void 0}var c={url:e,method:e,data:e,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:i};return S.forEach(Object.keys(t).concat(Object.keys(r)),function(e){var t=c[e]||s,r=t(e);S.isUndefined(r)&&t!==i||(n[e]=r)}),n}var S=n,g="0.26.1",Te=g,Ee={},_e=(["object","boolean","number","function","string","symbol"].forEach(function(t,r){Ee[t]=function(e){return typeof e===t||"a"+(r<1?"n ":" ")+t}}),{});Ee.transitional=function(n,o,r){function s(e,t){return"[Axios v"+Te+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(e,t,r){if(!1===n)throw new Error(s(t," has been removed"+(o?" in "+o:"")));return o&&!_e[t]&&(_e[t]=!0,console.warn(s(t," has been deprecated since v"+o+" and will be removed in the near future"))),!n||n(e,t,r)}};var h=n,Re=J,Ce=H,Ue=function(t){return Se(t),t.headers=t.headers||{},t.data=ve.call(t,t.data,t.headers,t.transformRequest),t.headers=be.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),be.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||ke.adapter)(t).then(function(e){return Se(t),e.data=ve.call(t,e.data,e.headers,t.transformResponse),e},function(e){return we(e)||(Se(t),e&&e.response&&(e.response.data=ve.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})},O=Oe,xe={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),o=n.length;0<o--;){var s=n[o],a=t[s];if(a){var i=e[s],a=void 0===i||a(i,s,e);if(!0!==a)throw new TypeError("option "+s+" must be "+a)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:Ee},T=xe.validators;function E(e){this.defaults=e,this.interceptors={request:new Ce,response:new Ce}}E.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=O(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r,e=t.transitional,n=(void 0!==e&&xe.assertOptions(e,{silentJSONParsing:T.transitional(T.boolean),forcedJSONParsing:T.transitional(T.boolean),clarifyTimeoutError:T.transitional(T.boolean)},!1),[]),o=!0,s=(this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}),[]);if(this.interceptors.response.forEach(function(e){s.push(e.fulfilled,e.rejected)}),!o){var a=[Ue,void 0];for(Array.prototype.unshift.apply(a,n),a=a.concat(s),r=Promise.resolve(t);a.length;)r=r.then(a.shift(),a.shift());return r}for(var i=t;n.length;){var c=n.shift(),u=n.shift();try{i=c(i)}catch(e){u(e);break}}try{r=Ue(i)}catch(e){return Promise.reject(e)}for(;s.length;)r=r.then(s.shift(),s.shift());return r},E.prototype.getUri=function(e){return e=O(this.defaults,e),Re(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},h.forEach(["delete","get","head","options"],function(r){E.prototype[r]=function(e,t){return this.request(O(t||{},{method:r,url:e,data:(t||{}).data}))}}),h.forEach(["post","put","patch"],function(n){E.prototype[n]=function(e,t,r){return this.request(O(r||{},{method:n,url:e,data:t}))}});var _=E,je=b;function R(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});var t,n=this;this.promise.then(function(e){if(n._listeners){for(var t=n._listeners.length,r=0;r<t;r++)n._listeners[r](e);n._listeners=null}}),this.promise.then=function(e){var t,e=new Promise(function(e){n.subscribe(e),t=e}).then(e);return e.cancel=function(){n.unsubscribe(t)},e},e(function(e){n.reason||(n.reason=new je(e),t(n.reason))})}R.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},R.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},R.prototype.unsubscribe=function(e){!this._listeners||-1!==(e=this._listeners.indexOf(e))&&this._listeners.splice(e,1)},R.source=function(){var t;return{token:new R(function(e){t=e}),cancel:t}};var H=R,Ke=n,Pe=n,qe=I,C=_,Ie=Oe;var h=function t(r){var e=new C(r),n=qe(C.prototype.request,e);return Pe.extend(n,C.prototype,e),Pe.extend(n,e),n.create=function(e){return t(Ie(r,e))},n}(p),Ne=(h.Axios=C,h.Cancel=b,h.CancelToken=H,h.isCancel=ye,h.VERSION=g,h.all=function(e){return Promise.all(e)},h.spread=function(t){return function(e){return t.apply(null,e)}},h.isAxiosError=function(e){return Ke.isObject(e)&&!0===e.isAxiosError},e.exports=h,e.exports.default=h,e.exports),U=function(e,a,i,c){return new(i=i||Promise)(function(r,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function o(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(n,o)}s((c=c.apply(e,a||[])).next())})};f.OauthStorageKeys=void 0,(n=f.OauthStorageKeys||(f.OauthStorageKeys={})).AccessTokenKey="access_token",n.RefreshTokenKey="refresh_token",n.AccessScopeKey="scope",n.TokenTypeKey="token_type",n.ExpiresInKey="expires_in",n.CurrentStateKey="current_state";class ze{get(r){return new Promise(e=>{if("undefined"!=typeof localStorage){var t=localStorage.getItem(r);if(x.assertAvailable(t))return e(t)}if("undefined"!=typeof sessionStorage){t=sessionStorage.getItem(r);if(x.assertAvailable(t))return e(t)}return e(null)})}set(r,n,o=!1){return new Promise((e,t)=>{o?"undefined"!=typeof sessionStorage?(sessionStorage.setItem(r,n),e()):t():"undefined"!=typeof localStorage?(localStorage.setItem(r,n),e()):t()})}remove(t){return new Promise(e=>{"undefined"!=typeof localStorage&&localStorage.removeItem(t),"undefined"!=typeof sessionStorage&&sessionStorage.removeItem(t),e()})}clearAll(t=!1){return new Promise(e=>{"undefined"!=typeof localStorage&&localStorage.clear(),t&&"undefined"!=typeof sessionStorage&&sessionStorage.clear(),e()})}}class x{static parseJWT(e){e=e.split(".");return e&&3==e.length?Buffer.from(e[1]).toString("base64"):null}static hasJWTExpired(e){e=this.parseJson(this.parseJWT(e)),e=e?e.exp:null;return!e||parseInt(e)<Math.floor(Date.now()/1e3)+10}static safeString(e){return x.assertAvailable(e)?e:""}static safeInt(e){return x.assertAvailable(e)?e:0}static assertAvailable(e){return null!=e&&void 0!==e&&""!==e}static count(e){let t=0;for(const r in e)e.hasOwnProperty(r)&&t++;return t}static mergeObj(t,r){return Object.keys(r).forEach(e=>{r.hasOwnProperty(e)&&(Array.isArray(t)?t.push(r[e]):t[this.count(t)]=r[e])}),t}static urlEncodeObject(e){const a=(e,t,r)=>{const n=[];for(const s in e[t]){var o;e[t].hasOwnProperty(s)&&null!==e[t][s]&&void 0!==e[t][s]&&("object"==typeof e[t][s]||Array.isArray(e[t][s])?(o=r+"["+s+"]",this.mergeObj(n,a(e[t],s,o))):n.push(encodeURIComponent(r+"["+s+"]")+"="+encodeURIComponent(e[t][s])))}return n};const t=(e=>{const t=[];if(null!==e&&"object"==typeof e)for(const r in e)e.hasOwnProperty(r)&&null!==e[r]&&void 0!==e[r]&&("object"==typeof e[r]||Array.isArray(e[r])?this.mergeObj(t,a(e,r,r)):t.push(r+"="+encodeURIComponent(e[r])));return t})(e);return 0<t.length?t.join("&"):""}static parseJson(e){try{return JSON.parse(e)}catch(e){return null}}static getUrlParam(e,t){t||"undefined"==typeof location||(t=location.href),t=decodeURIComponent(t),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const r=new RegExp("[\\?&]"+e+"=([^&#]*)");e=r.exec(t);return null==e?null:e[1]}static stripUrlParams(e){return x.assertAvailable(e)?e.split("?")[0]:e}static generateKey(t){x.assertAvailable(t)||(t=16);let r="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<t;e++)r+=n.charAt(Math.floor(Math.random()*n.length));return r}}class j{constructor(e){if(!x.assertAvailable(e.clientId))throw new Error("'clientId' Required");if(this.clientId=e.clientId,!x.assertAvailable(e.clientSecret))throw new Error("'clientSecret' Required");if(this.clientSecret=e.clientSecret,!x.assertAvailable(e.authorizeUrl))throw new Error("'authorizeUrl'  Required");if(this.authorizeUrl=e.authorizeUrl,!x.assertAvailable(e.tokenUrl))throw new Error("'tokenUrl' Required");this.tokenUrl=e.tokenUrl,x.assertAvailable(e.verifyTokenUrl)&&(this.verifyTokenUrl=e.verifyTokenUrl),x.assertAvailable(e.storage)&&(j._storage=e.storage)}static get storage(){return this._storage}saveAccess(e){return U(this,void 0,void 0,function*(){return Promise.all([j.storage.set(f.OauthStorageKeys.AccessTokenKey,x.safeString(e.accessToken)),j.storage.set(f.OauthStorageKeys.RefreshTokenKey,x.safeString(e.refreshToken)),j.storage.set(f.OauthStorageKeys.AccessScopeKey,x.safeString(e.accessScope)),j.storage.set(f.OauthStorageKeys.TokenTypeKey,x.safeString(e.tokenType)),j.storage.set(f.OauthStorageKeys.ExpiresInKey,String(x.safeInt(Math.floor(Date.now()/1e3)+e.expiresIn)))])})}clearAccess(){return U(this,void 0,void 0,function*(){Promise.all([j.storage.remove(f.OauthStorageKeys.AccessTokenKey),j.storage.remove(f.OauthStorageKeys.RefreshTokenKey),j.storage.remove(f.OauthStorageKeys.AccessScopeKey),j.storage.remove(f.OauthStorageKeys.TokenTypeKey),j.storage.remove(f.OauthStorageKeys.ExpiresInKey),j.storage.remove(f.OauthStorageKeys.CurrentStateKey)])})}authorizeAccess(l){return U(this,void 0,void 0,function*(){let o=x.assertAvailable(l.grant_type)?l.grant_type:f.OauthGrantType.Client_Credentials;const s=x.assertAvailable(l.allowed_grant_types)?l.allowed_grant_types:[],a=x.assertAvailable(l.redirect_uri)?l.redirect_uri:x.stripUrlParams("undefined"!=typeof window?window.location.origin:null),i=x.assertAvailable(l.scope)?l.scope:[];let c=x.assertAvailable(l.state)?l.state:x.generateKey(32);const u=()=>U(this,void 0,void 0,function*(){switch(o){case f.OauthGrantType.Auto:o=x.assertAvailable(l.user_id)||x.assertAvailable(x.getUrlParam("code"))?f.OauthGrantType.Authorization_Code:x.assertAvailable(l.username)&&x.assertAvailable(l.password)?f.OauthGrantType.User_Credentials:f.OauthGrantType.Client_Credentials,s.includes(o)?u():l.callback(!1);break;case f.OauthGrantType.Authorization_Code:var e,t=x.getUrlParam("code"),r=x.getUrlParam("error"),n=x.getUrlParam("error_description");x.assertAvailable(t)?(e=yield j.storage.get(f.OauthStorageKeys.CurrentStateKey),(c=x.assertAvailable(e)?e:c)===x.getUrlParam("state")?this.oauthTokenWithAuthorizationCode(t,a,e=>U(this,void 0,void 0,function*(){x.assertAvailable(e)?x.assertAvailable(e.accessToken)?(j.storage.remove(f.OauthStorageKeys.CurrentStateKey),yield this.saveAccess(e),"function"==typeof l.callback&&l.callback(yield j.storage.get(f.OauthStorageKeys.AccessTokenKey)),"undefined"!=typeof window&&window.location.replace(x.stripUrlParams(window.location.href))):x.assertAvailable(e.error)?"function"==typeof l.callback&&l.callback(!1,e.errorDescription):"function"==typeof l.callback&&l.callback(!1):"function"==typeof l.callback&&l.callback(!1)})):"function"==typeof l.callback&&l.callback(!1,"Failed authorize access. CSRF Verification Failed")):x.assertAvailable(r)?(j.storage.remove(f.OauthStorageKeys.CurrentStateKey),x.assertAvailable(n)?"function"==typeof l.callback&&l.callback(!1,n):"function"==typeof l.callback&&l.callback(!1,"Failed authorize access")):this.oauthAuthorize(i,a,l.user_id,c);break;case f.OauthGrantType.User_Credentials:this.oauthTokenWithUserCredentials(l.username,l.password,i,e=>U(this,void 0,void 0,function*(){x.assertAvailable(e)?x.assertAvailable(e.accessToken)?(yield this.saveAccess(e),"function"==typeof l.callback&&l.callback(yield j.storage.get(f.OauthStorageKeys.AccessTokenKey))):x.assertAvailable(e.error)?"function"==typeof l.callback&&l.callback(!1,e.errorDescription):"function"==typeof l.callback&&l.callback(!1):"function"==typeof l.callback&&l.callback(!1)}));break;default:f.OauthGrantType.Client_Credentials;this.oauthTokenWithClientCredentials(i,e=>U(this,void 0,void 0,function*(){x.assertAvailable(e)?x.assertAvailable(e.accessToken)?(yield this.saveAccess(e),"function"==typeof l.callback&&l.callback(yield j.storage.get(f.OauthStorageKeys.AccessTokenKey))):x.assertAvailable(e.error)?"function"==typeof l.callback&&l.callback(!1,e.errorDescription):"function"==typeof l.callback&&l.callback(!1):"function"==typeof l.callback&&l.callback(!1)}))}});var e,t,r=e=>{this.oauthRefreshToken(e,e=>U(this,void 0,void 0,function*(){x.assertAvailable(e)?x.assertAvailable(e.accessToken)?(yield this.saveAccess(e),"function"==typeof l.callback&&l.callback(yield j.storage.get(f.OauthStorageKeys.AccessTokenKey))):x.assertAvailable(e.error)?"function"==typeof l.callback&&(l.callback(!1,e.errorDescription),this.clearAccess(),u()):"function"==typeof l.callback&&(this.clearAccess(),l.callback(!1)):"function"==typeof l.callback&&l.callback(!1)}))};x.assertAvailable(x.getUrlParam("access_token"))?(e=x.getUrlParam("access_token"),(yield this.hasExpired(e))?"function"==typeof l.callback&&l.callback(!1):"function"==typeof l.callback&&l.callback(!x.assertAvailable(e)||e)):(e=yield j.storage.get(f.OauthStorageKeys.AccessTokenKey),t=yield j.storage.get(f.OauthStorageKeys.RefreshTokenKey),x.assertAvailable(e)?(yield this.hasExpired(e))?x.assertAvailable(t)?r(t):u():"function"==typeof l.callback&&l.callback(e):u())})}hasExpired(t){return U(this,void 0,void 0,function*(){if(t=t||(yield j.storage.get(f.OauthStorageKeys.AccessTokenKey)),x.assertAvailable(t)){if(x.parseJWT(t)&&!x.hasJWTExpired(t))return!1;var e=yield j.storage.get(f.OauthStorageKeys.ExpiresInKey);if(x.assertAvailable(e))return parseInt(e)<Math.floor(Date.now()/1e3)+10}return!0})}oauthAuthorize(e,t,r,n,o){if(!x.assertAvailable(t))throw new Error("'redirect_url' Required");j.storage.set(f.OauthStorageKeys.CurrentStateKey,n,!0);e={client_id:this.clientId,scope:e.join(" "),state:n,response_type:"code",user_id:r,redirect_uri:t},n=this.authorizeUrl+"?"+x.urlEncodeObject(e);o?o(n):"undefined"!=typeof window&&window.open(n,"_blank")}oauthAuthorizeWithEmail(e,t,r,n,o){if(!x.assertAvailable(t))throw new Error("'redirect_url' Required");j.storage.set(f.OauthStorageKeys.CurrentStateKey,n,!0);e={client_id:this.clientId,scope:e.join(" "),state:n,response_type:"code",email:r,redirect_uri:t},n=this.authorizeUrl+"?"+x.urlEncodeObject(e);o?o(n):"undefined"!=typeof window&&window.open(n,"_blank")}oauthAuthorizeImplicit(e,t,r,n,o){if(!x.assertAvailable(t))throw new Error("'redirect_url' Required");if(!x.assertAvailable(e))throw new Error("'scope' Required");j.storage.set(f.OauthStorageKeys.CurrentStateKey,n,!0);e={client_id:this.clientId,scope:e.join(" "),state:n,response_type:"token",user_id:r,redirect_uri:t},n=this.authorizeUrl+"?"+x.urlEncodeObject(e);o?o(n):"undefined"!=typeof window&&window.open(n,"_blank")}oauthTokenWithClientCredentials(e,r){K.post({url:this.tokenUrl,params:{grant_type:f.OauthGrantType.Client_Credentials,client_id:this.clientId,client_secret:this.clientSecret,scope:e.join(" ")},success:e=>{"function"==typeof r&&r(new q(e))},fail:(e,t)=>{"function"==typeof r&&r(new q(e),t)}})}oauthTokenWithUserCredentials(e,t,r,n){if(!x.assertAvailable(e))throw new Error("'username' Required");if(!x.assertAvailable(t))throw new Error("'password' Required");K.post({url:this.tokenUrl,params:{grant_type:f.OauthGrantType.User_Credentials,client_id:this.clientId,client_secret:this.clientSecret,username:e,password:t,scope:r.join(" ")},success:e=>{"function"==typeof n&&n(new q(e))},fail:(e,t)=>{"function"==typeof n&&n(new q(e),t)}})}oauthTokenWithAuthorizationCode(e,t,r){if(!x.assertAvailable(e))throw new Error("'code' Required");if(!x.assertAvailable(t))throw new Error("'redirect_uri' Required");K.post({url:this.tokenUrl,params:{grant_type:f.OauthGrantType.Authorization_Code,code:e,redirect_uri:t,client_id:this.clientId,client_secret:this.clientSecret},success:e=>{"function"==typeof r&&r(new q(e))},fail:(e,t)=>{"function"==typeof r&&r(new q(e),t)}})}oauthRefreshToken(e,r){if(!x.assertAvailable(e))throw new Error("'refresh_token' Required");K.post({url:this.tokenUrl,params:{grant_type:f.OauthGrantType.Refresh_Token,refresh_token:e,client_id:this.clientId,client_secret:this.clientSecret},success:e=>{"function"==typeof r&&r(new q(e))},fail:(e,t)=>{"function"==typeof r&&r(new q(e),t)}})}oauthVerifyToken(e,r){if(!x.assertAvailable(this.verifyTokenUrl))throw new Error("'verifyTokenUrl' was not specified");if(!x.assertAvailable(e))throw new Error("'access_token' Required");K.get({url:this.verifyTokenUrl,withAccessToken:!0,accessToken:e,success:e=>{"function"==typeof r&&r(new P(e))},fail:(e,t)=>{"function"==typeof r&&r(new P(e),t)}})}}j._storage=new ze,f.OauthGrantType=void 0,(_=f.OauthGrantType||(f.OauthGrantType={})).Client_Credentials="client_credentials",_.Authorization_Code="authorization_code",_.User_Credentials="password",_.Refresh_Token="refresh_token",_.Auto="auto",f.OauthRequestMethod=void 0,(p=f.OauthRequestMethod||(f.OauthRequestMethod={})).GET="get",p.POST="post",p.PUT="put",p.DELETE="delete";class K{constructor(e=f.OauthRequestMethod.GET){this.method=e,this.axhttp=Ne.create({timeout:2e4})}static get(e){const t=new K(f.OauthRequestMethod.GET);return t.request(e)}static post(e){const t=new K(f.OauthRequestMethod.POST);return t.request(e)}static put(e){const t=new K(f.OauthRequestMethod.PUT);return t.request(e)}static delete(e){const t=new K(f.OauthRequestMethod.DELETE);return t.request(e)}request(r){return U(this,void 0,void 0,function*(){let e={url:r.url,method:this.method,params:r.query||{},data:r.params||{},headers:r.headers||{}};r.withCredentials&&(e.auth={username:r.username,password:r.password}),r.withAccessToken&&(e.headers.Authorization=(r.accessTokenType||"Bearer")+" "+r.accessToken);try{var t=yield this.axhttp.request(e);return t?(200===t.status||201===t.status?r.success(t.data):r.fail(t.data,t.statusText),t.data):null}catch(e){return Ne.isAxiosError(e)?(r.fail(e.response.data,e.message),e.response.data):(e instanceof Error?r.fail(null,e.message):"string"==typeof e?r.fail(null,e):r.fail(),null)}})}}class P{constructor(e){e&&(this.success=e.success,this.error=e.error,this.errorDescription=e.error_description)}}class Be{constructor(e){e&&(this.state=e.state,this.code=e.code,this.error=e.error,this.errorDescription=e.error_description)}}class q{constructor(e){e&&(this.accessToken=e.access_token,this.refreshToken=e.refresh_token,this.tokenType=e.token_type,this.accessScope=e.scope,this.expiresIn=e.expires_in,this.error=e.error,this.errorDescription=e.error_description)}}f.Oauth=j,f.OauthAuthorizationResponse=Be,f.OauthRequest=K,f.OauthResponse=class{static parseVerificationResponse(e){e=x.parseJson(e),e=new P(e);return e&&x.assertAvailable(e.success)||e&&x.assertAvailable(e.error)?e:null}static parseAuthorizationResponse(e){e=x.parseJson(e),e=new Be(e);return e&&x.assertAvailable(e.code)||e&&x.assertAvailable(e.error)?e:null}static parseTokenResponse(e){e=x.parseJson(e),e=new q(e);return e&&x.assertAvailable(e.accessToken)||e&&x.assertAvailable(e.error)?e:null}},f.OauthStorage=ze,f.OauthTokenResponse=q,f.OauthUtils=x,f.OauthVerificationResponse=P,Object.defineProperty(f,"__esModule",{value:!0})});